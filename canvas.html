<!DOCTYPE html>
<html>
<head>

<style type="text/css">
table.main
{
}
.main>tr>td
{
margin: 0;
padding: 0;
}

table.sub
{
border-width: 0 0 2px 2px;
border-spacing: 0;
border-color: black;
border-style: solid;
}
.sub td
{
width: 20px;
height: 20px;
border-width: 2px 2px 0 0;
border-style: solid;
border-color: black;
}

p.in-cell
{
text-align: center;
margin: 0 0 0 0;
}
</style>

<title>Canvas test</title>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.8/jquery.min.js"></script>

<script>
function url(root,parameters){
  root+='?time='+new Date().getTime()
  for (var key in parameters){
    root+='&'+key+'='+parameters[key];
    }
  return root;
  }
  

var gameID
var timer
$.ajaxSetup({cache:false});

$(document).ready(function(){
//set up the board display
s="<table class='main'>";
for(z=0;z<4;z++)
  {
  s+="<tr><td><table class='sub'>";
  for(y=0;y<4;y++)
    {
    s+="<tr>";
    for(x=0;x<4;x++)
      {
      s+="<td id='t"+x+y+z+"'><p id='p"+x+y+z+"' class=in-cell></p></td>";
      }
    s+="</tr>";
    }
  s+="</table></td></tr>";
  }
s+="</table>";
$("body").append(s);

$(".sub td").click(function(){
  player=$("#player").val()
  if (player=="X" || player=="O"){
    $.post('post?pos='+$(this).attr("id").substr(1)+'&gameID='+gameID+'&player='+player,
    function(data){$("#error").val(data.error)},'json')
    }
  });
$("#error").val("none")
//give the game an id
gameID={{gameID}}

  
//poll the server regularly
timer=setInterval(function(){
  player=$("#player").val()
  if (player=="X" || player=="O"){
    $.getJSON('get',{'gameID':gameID,'player':player}, success=function(data){
      for(z=0;z<4;z++){
        for(y=0;y<4;y++){
          for(x=0;x<4;x++){
            $("#p"+x+y+z).text(data.board[z*16+y*4+x]);
            }
          }
        }
      });
    }
  }, 5000);

});

function st(){clearInterval(timer);}
</script>
</head>
<body>
<input type="text" id="player" value="X"></input>
<input type="button" onclick="$.post('clr',{'gameID':gameID});"></input>
<input type="text" id="error" value="" disabled="disabled"></input>

</body>
</html>
