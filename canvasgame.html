<!DOCTYPE html>
<html>
<head>

<style type="text/css">
table.main
{
}
.main>tr>td
{
margin: 0;
padding: 0;
}

table.sub
{
border-width: 0 0 2px 2px;
border-spacing: 0;
border-color: black;
border-style: solid;
}
.sub td
{
width: 20px;
height: 20px;
border-width: 2px 2px 0 0;
border-style: solid;
border-color: black;
}

p.in-cell
{
text-align: center;
margin: 0 0 0 0;
}

td.won
{
background-color: red;
}
</style>

<title>Canvas test</title>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.8/jquery.min.js"></script>

<script>
//give the game an id
var gameID={{gameID}}
var timer

function postMsg(data){$("#error").val(data.error);}

function Show(data){
  for(z=0;z<4;z++){
    for(y=0;y<4;y++){
      for(x=0;x<4;x++){
        $("#p"+x+y+z).text(data.board[z*16+y*4+x]);
        $("#t"+x+y+z).removeClass("won");
        }
      }
    }
  for (i in data.wonlines){
    line=data.wonlines[i]
    for(j=0;j<4;j++){
      $("#t"+line[j][0]+line[j][1]+line[j][2]).addClass("won");
      }
    }
  }


//functions independent of IO
function click(pos,player){
  $.post('post?pos='+pos+'&gameID='+gameID+'&player='+player,
  postMsg,'json')
  }
  
function poll(player){
  $.getJSON('get',{'gameID':gameID,'player':player}, Show);
  }

//end of IO independent functions
$.ajaxSetup({cache:false});

$(document).ready(function(){

$(".sub td").click(function(){
  var player=$("#player").val()
  if (player=="X" || player=="O"){
    click($(this).attr("id").substr(1),player)
    }
  });
$("#error").val("none")

  
//poll the server regularly
timer=setInterval(function(){
  var player=$("#player").val()
  if (player=="X" || player=="O"){poll(player);}
  }, 5000);

});

function st(){clearInterval(timer);}


String.prototype.lpad = function(padString, length) {
	var str = this;
	while (str.length < length)
		str = padString + str;
	return str;
}
</script>
</head>
<body>
<input type="text" id="player" value="X"></input>
<input type="button" onclick="$.post('clr',{'gameID':gameID});"></input>
<input type="text" id="error" value="" disabled="disabled"></input>

<canvas id="myCanvas" width="100" height="400"
style="border:1px solid #000000;">
your browser does not support this feature
</canvas>

<script>
var c=document.getElementById("myCanvas");
var ctx=c.getContext("2d");

function col(r,g,b){
return "#"+(b+g*256+r*256*256).toString(16).lpad("0",6)}

for(x=0;x<4;x++){
	for(y=0;y<4;y++){
		for(z=0;z<4;z++){
			ctx.fillStyle=col(64*x,64*y,64*z);
			ctx.fillRect(25*x,100*z+25*y,25,25);
		}
	}
}

</script>
</body>
</html>
